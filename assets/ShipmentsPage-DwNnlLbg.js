const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shipmentService-CfE1abXj.js","assets/index-DCaJRxld.js","assets/ui-BUgdJNRx.js","assets/vendor-D4-GdBKu.js","assets/index-DG2lB-RE.css"])))=>i.map(i=>d[i]);
import{c as e,b as s,t,_ as a,N as i,B as l,C as n,d as r,e as d,f as c,P as m}from"./index-DCaJRxld.js";import{j as x}from"./ui-BUgdJNRx.js";import{r as o,L as h}from"./vendor-D4-GdBKu.js";import{f as p,D as u,a as g}from"./labelService-DglM6UPf.js";import{T as j,a as f,b as v,c as N}from"./tabs-CPTzWCgV.js";import{L as b,R as y}from"./refresh-cw-CIFs0Ljt.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),k=()=>{const{user:e,isSignedIn:k}=s(),[_,S]=o.useState([]),[C,D]=o.useState(!0),[P,A]=o.useState("all"),[L,T]=o.useState(null);o.useEffect((()=>{k&&e&&E()}),[k,e]);const E=async()=>{if(e){D(!0);try{const s=await p(e.id);if(s&&s.length>0){const e=s.map((e=>({id:e.id.toString(),userId:e.user_id,trackingCode:e.tracking_code||"",carrier:{name:e.carrier_name||"E-Parcel Nordic",price:Number(e.carrier_price)||10},weight:e.weight||"",dimensions:{length:e.dimension_length||"",width:e.dimension_width||"",height:e.dimension_height||""},pickup:e.pickup_address||"",delivery:e.delivery_address||"",deliverySpeed:e.delivery_speed||"standard",includeCompliance:e.include_compliance||!1,status:e.status||"pending",createdAt:e.created_at,labelUrl:e.label_url,pickupTime:e.pickup_time,totalPrice:Number(e.total_price)||10,estimatedDelivery:e.estimated_delivery?new Date(e.estimated_delivery).toISOString().split("T")[0]:void 0,events:[]})));S(e)}else{const s=await I(e.id);S(s)}}catch(s){t({title:"Loading Error",description:"Could not load your shipments. Please try again.",variant:"destructive"})}finally{D(!1)}}},I=async e=>{try{return await a((()=>import("./shipmentService-CfE1abXj.js")),__vite__mapDeps([0,1,2,3,4])).then((s=>s.getShipments(e)))}catch(s){return[]}},U=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-blue-100 text-blue-800";case"in_transit":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"exception":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},$="all"===P?_:_.filter((e=>{switch(P){case"active":return["pending","picked_up","in_transit"].includes(e.status);case"delivered":return"delivered"===e.status;case"exception":return"exception"===e.status;case"cancelled":return"cancelled"===e.status;default:return!0}}));return x.jsxs("div",{className:"min-h-screen bg-background",children:[x.jsx(i,{}),x.jsx("div",{className:"container mx-auto px-4 py-8",children:x.jsxs("div",{className:"flex flex-col gap-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("div",{className:"flex items-center gap-2 mb-2",children:x.jsx(l,{variant:"ghost",size:"sm",asChild:!0,className:"flex items-center gap-1 -ml-2",children:x.jsxs(h,{to:"/dashboard",children:[x.jsx(w,{className:"h-4 w-4"})," Back to Dashboard"]})})}),x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Shipments"}),x.jsx("p",{className:"text-muted-foreground",children:"Track and manage all your shipments"})]}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs(l,{variant:"outline",onClick:()=>{E()},disabled:C,children:[C?x.jsx(b,{className:"h-4 w-4 animate-spin"}):x.jsx(y,{className:"h-4 w-4"}),x.jsx("span",{className:"ml-2",children:"Refresh"})]}),x.jsx(l,{asChild:!0,children:x.jsx(h,{to:"/shipment",children:"New Shipment"})})]})]}),x.jsxs(n,{children:[x.jsx(r,{className:"pb-2",children:x.jsx(d,{children:"Shipment List"})}),x.jsx(c,{children:x.jsxs(j,{defaultValue:"all",value:P,onValueChange:A,className:"w-full",children:[x.jsxs(f,{className:"mb-4",children:[x.jsx(v,{value:"all",children:"All Shipments"}),x.jsx(v,{value:"active",children:"Active"}),x.jsx(v,{value:"delivered",children:"Delivered"}),x.jsx(v,{value:"exception",children:"Exceptions"}),x.jsx(v,{value:"cancelled",children:"Cancelled"})]}),x.jsx(N,{value:P,className:"mt-0",children:C?x.jsx("div",{className:"flex justify-center p-8",children:x.jsx(b,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===$.length?x.jsxs("div",{className:"text-center py-8",children:[x.jsx(m,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),x.jsx("h3",{className:"font-medium text-lg mb-2",children:"all"===P?"No shipments found":`No ${P} shipments found`}),x.jsx("p",{className:"text-muted-foreground mb-4",children:"all"===P?"Book your first shipment to get started":"Try selecting a different filter or book a new shipment"}),x.jsx(l,{asChild:!0,children:x.jsx(h,{to:"/shipment",children:"Book a Shipment"})})]}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full border-collapse",children:[x.jsx("thead",{children:x.jsxs("tr",{className:"border-b border-border",children:[x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Tracking"}),x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Route"}),x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Status"}),x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Created"}),x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Delivery"}),x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Price"}),x.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Actions"})]})}),x.jsx("tbody",{className:"divide-y divide-border",children:$.map((e=>x.jsxs("tr",{className:"hover:bg-muted/50",children:[x.jsxs("td",{className:"py-3 px-4",children:[x.jsx("div",{className:"font-medium",children:e.trackingCode}),x.jsx("div",{className:"text-xs text-muted-foreground",children:e.carrier.name})]}),x.jsx("td",{className:"py-3 px-4",children:x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{className:"truncate max-w-[150px]",title:e.pickup,children:e.pickup}),x.jsx("span",{className:"text-xs",children:"↓"}),x.jsx("span",{className:"truncate max-w-[150px]",title:e.delivery,children:e.delivery})]})}),x.jsx("td",{className:"py-3 px-4",children:x.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${U(e.status)}`,children:["pending"===e.status&&"Pending","picked_up"===e.status&&"Picked Up","in_transit"===e.status&&"In Transit","delivered"===e.status&&"Delivered","exception"===e.status&&"Exception","cancelled"===e.status&&"Cancelled"]})}),x.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:new Date(e.createdAt).toLocaleDateString()}),x.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:e.estimatedDelivery?new Date(e.estimatedDelivery).toLocaleDateString():"N/A"}),x.jsxs("td",{className:"py-3 px-4 whitespace-nowrap",children:["€",e.totalPrice.toFixed(2)]}),x.jsx("td",{className:"py-3 px-4",children:x.jsxs("div",{className:"flex gap-2",children:[x.jsx(l,{size:"sm",variant:"outline",asChild:!0,children:x.jsx(h,{to:`/tracking?code=${e.trackingCode}`,children:"Track"})}),x.jsxs(l,{size:"sm",variant:"outline",onClick:()=>(async e=>{const s=e.trackingCode,a="SHIP-"+Math.floor(1e6*Math.random());if(s){T(e.id);try{const i=`${e.dimensions.length}x${e.dimensions.width}x${e.dimensions.height} cm`,l=await g({shipmentId:a,carrierName:e.carrier.name,trackingCode:s,senderAddress:e.pickup,recipientAddress:e.delivery,packageDetails:{weight:e.weight,dimensions:i},language:"en"});l.success?(window.open(l.labelUrl,"_blank"),t({title:"Label Generated",description:"Your shipping label has been generated successfully"})):t({title:"Label Generation Failed",description:l.message||"Unable to generate shipping label",variant:"destructive"})}catch(i){t({title:"Label Generation Error",description:"An unexpected error occurred",variant:"destructive"})}finally{T(null)}}else t({title:"Error",description:"Unable to generate label: missing tracking code",variant:"destructive"})})(e),disabled:L===e.id,children:[L===e.id?x.jsx(b,{className:"h-3 w-3 animate-spin"}):x.jsx(u,{className:"h-3 w-3 mr-1"}),"Label"]})]})})]},e.id)))})]})})})]})})]}),x.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4",children:[x.jsx("h3",{className:"font-medium mb-2",children:"About Shipment Statuses"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("div",{className:"flex items-center gap-2 mb-1",children:x.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full text-xs",children:"Pending"})}),x.jsx("p",{className:"text-muted-foreground",children:"Shipment has been booked but not yet picked up."})]}),x.jsxs("div",{children:[x.jsx("div",{className:"flex items-center gap-2 mb-1",children:x.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs",children:"Picked Up"})}),x.jsx("p",{className:"text-muted-foreground",children:"Carrier has collected the package."})]}),x.jsxs("div",{children:[x.jsx("div",{className:"flex items-center gap-2 mb-1",children:x.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full text-xs",children:"In Transit"})}),x.jsx("p",{className:"text-muted-foreground",children:"Package is on its way to the destination."})]}),x.jsxs("div",{children:[x.jsx("div",{className:"flex items-center gap-2 mb-1",children:x.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs",children:"Delivered"})}),x.jsx("p",{className:"text-muted-foreground",children:"Package has been delivered successfully."})]}),x.jsxs("div",{children:[x.jsx("div",{className:"flex items-center gap-2 mb-1",children:x.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded-full text-xs",children:"Cancelled"})}),x.jsx("p",{className:"text-muted-foreground",children:"Shipment has been cancelled."})]})]})]})]})})]})};export{k as default};
