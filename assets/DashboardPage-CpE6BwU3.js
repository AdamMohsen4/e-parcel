const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shipmentService-5eWvZyUL.js","assets/index-CHSTzK31.js","assets/vendor-react-c2Vhr46D.js","assets/vendor-Do_qGNvM.js","assets/vendor-ui-CttiZxwU.js","assets/index-CgNEjc2t.css"])))=>i.map(i=>d[i]);
import{j as e,r as s,ay as t,ae as i,R as a,Y as r,K as n,u as l,az as d,a1 as c,aA as m,aB as o,M as x,aC as h,as as p,aD as u}from"./vendor-react-c2Vhr46D.js";import{B as j,t as g,C as v,e as f,j as N,a as b,s as y,N as w,k as S,T as k,f as _,h as C,i as D}from"./index-CHSTzK31.js";import{ax as A}from"./vendor-Do_qGNvM.js";import{a as U,f as L}from"./bookingDb-DitELtZx.js";import"./vendor-ui-CttiZxwU.js";const T=({status:s})=>e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-blue-100 text-blue-800";case"in_transit":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"exception":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(s)}`,children:(e=>{switch(e){case"pending":return"Pending";case"picked_up":return"Picked Up";case"in_transit":return"In Transit";case"delivered":return"Delivered";case"exception":return"Exception";case"cancelled":return"Cancelled";default:return"Unknown"}})(s)}),I=({shipment:a})=>{const[r,n]=s.useState(!1);return e.jsxs(j,{size:"sm",variant:"outline",onClick:async()=>{const e=a.trackingCode,s=a.id||"SHIP-"+Math.floor(1e6*Math.random());if(e){n(!0);try{const t=`${a.dimensions.length||"30"}x${a.dimensions.width||"20"}x${a.dimensions.height||"10"} cm`,i=a.pickup||"Unknown pickup location",r=a.delivery||"Unknown delivery location",n=await U({shipmentId:s,carrierName:a.carrier.name,trackingCode:e,senderAddress:i,recipientAddress:r,packageDetails:{weight:String(a.weight)||"1",dimensions:t},language:"en"});n.success?(window.open(n.labelUrl,"_blank"),g({title:"Label Generated",description:"Your shipping label has been generated successfully"})):g({title:"Label Generation Failed",description:n.message||"Unable to generate shipping label",variant:"destructive"})}catch(t){g({title:"Label Generation Error",description:"An unexpected error occurred",variant:"destructive"})}finally{n(!1)}}else g({title:"Error",description:"Unable to generate label: missing tracking code",variant:"destructive"})},disabled:r,children:[r?e.jsx(t,{className:"h-4 w-4 animate-spin"}):e.jsx(i,{className:"h-4 w-4 mr-1"}),"Label"]})},P=a.memo((({shipment:s})=>{const{trackingCode:t,status:i,createdAt:a}=s,n=new Date(a).toLocaleDateString();return e.jsx("div",{className:"py-4 first:pt-0 last:pb-0",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium",children:t}),e.jsx(T,{status:i})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Tracking: ",t]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:["Created: ",n]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{shipment:s}),e.jsx(j,{size:"sm",variant:"outline",asChild:!0,children:e.jsx(r,{to:`/tracking?code=${t}`,children:"Track"})})]})]})})})),E=()=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx(n,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-lg mb-2",children:"No shipments yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Book your first shipment to get started"}),e.jsx(j,{asChild:!0,children:e.jsx(r,{to:"/shipment",children:"Book a Shipment"})})]}),R=({limit:i,showViewAll:a=!1})=>{const[n,m]=s.useState([]),[o,x]=s.useState(!0),{user:h,isSignedIn:p}=l();s.useEffect((()=>{p&&h&&u()}),[p,h,i]);const u=async()=>{if(h){x(!0);try{const e=await L(h.id,i);if(e&&e.length>0){const s=e.map((e=>({id:e.id.toString(),userId:e.user_id,trackingCode:e.tracking_code||"",weight:e.weight||"",dimensions:{length:e.dimension_length||"",width:e.dimension_width||"",height:e.dimension_height||""},pickup:e.pickup_address||"",delivery:e.delivery_address||"",deliverySpeed:e.delivery_speed||"standard",includeCompliance:e.include_compliance||!1,status:e.status||"pending",createdAt:e.created_at,labelUrl:e.label_url,pickupTime:e.pickup_time,totalPrice:Number(e.total_price)||10,estimatedDelivery:e.estimated_delivery?new Date(e.estimated_delivery).toISOString().split("T")[0]:void 0,events:[]})));m(s)}else{const e=await y(h.id,i);m(e)}}catch(e){g({title:"Loading Error",description:"Could not load your shipments. Please try again.",variant:"destructive"})}finally{x(!1)}}},y=async(e,s)=>{try{const t=await A((()=>import("./shipmentService-5eWvZyUL.js")),__vite__mapDeps([0,1,2,3,4,5])).then((s=>s.getShipments(e)));return s?t.slice(0,s):t}catch(t){return[]}};return e.jsxs(v,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(N,{className:"text-xl",children:"My Shipments"}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>{u()},disabled:o,children:[o?e.jsx(t,{className:"h-4 w-4 animate-spin"}):e.jsx(d,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Refresh"})]})]}),e.jsx(b,{children:o?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(t,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===n.length?e.jsx(E,{}):e.jsxs("div",{className:"divide-y",children:[n.map((s=>e.jsx(P,{shipment:s},s.id))),a&&n.length>0&&e.jsx("div",{className:"pt-4",children:e.jsx(j,{variant:"link",className:"p-0 h-auto text-primary",asChild:!0,children:e.jsxs(r,{to:"/shipments",className:"flex items-center",children:["View all shipments ",e.jsx(c,{className:"ml-1 h-3 w-3"})]})})})]})})]})},$=()=>{const{user:t}=l(),[i,a]=s.useState({activeShipments:0,completedShipments:0,totalSpent:0,totalSaved:0}),[d,A]=s.useState([]),[U,L]=s.useState(!0);s.useEffect((()=>{t&&(T(),I())}),[t]);const T=async()=>{if(t){L(!0);try{const{data:e,error:s}=await y.from("booking").select("id").eq("user_id",t.id).in("status",["pending","picked_up","in_transit"]),{data:i,error:r}=await y.from("booking").select("id").eq("user_id",t.id).eq("status","delivered"),{data:n,error:l}=await y.from("booking").select("total_price, carrier_price").eq("user_id",t.id);if(!s&&!r&&!l){const s=(null==n?void 0:n.reduce(((e,s)=>e+(Number(s.total_price)||0)),0))||0,t=(null==n?void 0:n.reduce(((e,s)=>{const t=Number(s.total_price)||0,i=(Number(s.carrier_price)||0)+1.5;return e+Math.max(0,i-t)}),0))||0;a({activeShipments:(null==e?void 0:e.length)||0,completedShipments:(null==i?void 0:i.length)||0,totalSpent:s,totalSaved:t})}}catch(e){}finally{L(!1)}}},I=async()=>{if(t)try{const{data:e,error:s}=await y.from("booking").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(5);if(s)return;A(e||[])}catch(e){}},P=e=>{switch(null==e?void 0:e.toLowerCase()){case"delivered":return"bg-green-100 text-green-800";case"in_transit":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},E=e=>{if(!e)return"N/A";try{const s=new Date(e);return new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(s)}catch(s){return e}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(w,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome back, ",(null==t?void 0:t.firstName)||"User"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{variant:"outline",onClick:async()=>{L(!0);try{await Promise.all([T(),I()]),g({title:"Dashboard Refreshed",description:"Your dashboard data has been updated."})}catch(e){g({title:"Refresh Failed",description:"Could not refresh dashboard data. Please try again.",variant:"destructive"})}finally{L(!1)}},disabled:U,children:"Refresh Data"}),e.jsx(j,{asChild:!0,children:e.jsxs(r,{to:"/shipment",children:[e.jsx(n,{className:"mr-2 h-4 w-4"}),"New Shipment"]})})]})]}),e.jsxs(v,{className:"bg-primary/5 border-primary/20",children:[e.jsxs(f,{className:"pb-2",children:[e.jsx(N,{children:"Shipping Summary"}),e.jsx(S,{children:"Overview of your shipping activity"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(n,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Shipments"}),e.jsx("p",{className:"text-xl font-semibold",children:U?"...":i.activeShipments+i.completedShipments})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(m,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completion Rate"}),e.jsx("p",{className:"text-xl font-semibold",children:U?"...":i.activeShipments+i.completedShipments>0?`${Math.round(i.completedShipments/(i.activeShipments+i.completedShipments)*100)}%`:"0%"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(o,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Cost Per Shipment"}),e.jsx("p",{className:"text-xl font-semibold",children:U?"...":i.activeShipments+i.completedShipments>0?`€${(i.totalSpent/(i.activeShipments+i.completedShipments)).toFixed(2)}`:"€0.00"})]})]})]}),i.totalSaved>0]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(v,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Active Shipments"})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:U?"...":i.activeShipments}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(x,{className:"mr-1 h-4 w-4 text-primary"}),e.jsx("span",{children:"Shipments in progress"})]})]})]}),e.jsxs(v,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Completed Shipments"})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:U?"...":i.completedShipments}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(h,{className:"mr-1 h-4 w-4 text-primary"}),e.jsx("span",{children:"Successfully delivered"})]})]})]}),e.jsxs(v,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium",children:"Total Spent"})}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-2xl font-bold",children:["€",U?"...":i.totalSpent.toFixed(2)]}),e.jsx(k,{children:e.jsxs(_,{children:[e.jsx(C,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-full p-0",children:e.jsx(p,{className:"h-4 w-4 text-primary"})})}),e.jsx(D,{className:"max-w-[200px]",children:e.jsxs("p",{children:["You've saved €",i.totalSaved.toFixed(2)," compared to booking directly with carriers."]})})]})})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(p,{className:"mr-1 h-4 w-4 text-primary"}),e.jsx("span",{children:"Across all shipments"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(v,{className:"lg:col-span-1",children:[e.jsx(f,{children:e.jsx(N,{className:"text-xl",children:"Recent Activity"})}),e.jsx(b,{children:U?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):d.length>0?e.jsxs("div",{className:"space-y-4",children:[d.map((s=>e.jsxs("div",{className:"flex items-start gap-2 pb-4 border-b border-border last:border-0 last:pb-0",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(u,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.carrier_name||"Unknown carrier"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${P(s.status)}`,children:s.status||"Unknown"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["ID: ",s.tracking_code||"No tracking code"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:E(s.created_at)})]})]},s.id))),e.jsx("div",{className:"pt-2",children:e.jsx(j,{variant:"link",className:"p-0 h-auto text-primary",asChild:!0,children:e.jsxs(r,{to:"/shipments",className:"flex items-center",children:["View all shipments ",e.jsx(c,{className:"ml-1 h-3 w-3"})]})})})]}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"No recent activities found"}),e.jsx(j,{variant:"link",className:"mt-2",asChild:!0,children:e.jsx(r,{to:"/shipment",children:"Create your first shipment"})})]})})]}),e.jsxs(v,{className:"lg:col-span-2",children:[e.jsx(f,{children:e.jsx(N,{className:"text-xl",children:"Shipment List"})}),e.jsx(b,{children:e.jsx(R,{limit:5,showViewAll:!0})})]})]})]})})]})};export{$ as default};
