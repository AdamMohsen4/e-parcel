import{r as e,j as s,O as t,X as a,aE as r,aB as i,W as n,aF as d,aG as l,aH as c,aw as o,ax as m,n as u,aI as h,aJ as x,aK as p,aL as g,au as j,u as v,aM as f}from"./vendor-react-c2Vhr46D.js";import{c as N,B as y,D as S,l as w,m as b,n as C,C as _,e as k,j as D,a as T,d as A,s as L,t as R,N as M,k as q,I as B}from"./index-CHSTzK31.js";import{T as O,a as P,b as U,c as E}from"./tabs-SeVHyK0Y.js";import{B as I}from"./badge-Ct7_grzY.js";import{D as F,a as $,b as z,c as V,d as H,e as W,T as G}from"./textarea-DqHKpFE4.js";import{S as Y}from"./separator-C6m18iz5.js";import{ao as J,aD as K,aE as Q}from"./vendor-Do_qGNvM.js";import{updateShipmentStatus as X}from"./shipmentService-5eWvZyUL.js";import"./vendor-ui-CttiZxwU.js";const Z=e.forwardRef((({className:e,...t},a)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:a,className:N("w-full caption-bottom text-sm",e),...t})})));Z.displayName="Table";const ee=e.forwardRef((({className:e,...t},a)=>s.jsx("thead",{ref:a,className:N("[&_tr]:border-b",e),...t})));ee.displayName="TableHeader";const se=e.forwardRef((({className:e,...t},a)=>s.jsx("tbody",{ref:a,className:N("[&_tr:last-child]:border-0",e),...t})));se.displayName="TableBody",e.forwardRef((({className:e,...t},a)=>s.jsx("tfoot",{ref:a,className:N("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}))).displayName="TableFooter";const te=e.forwardRef((({className:e,...t},a)=>s.jsx("tr",{ref:a,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t})));te.displayName="TableRow";const ae=e.forwardRef((({className:e,...t},a)=>s.jsx("th",{ref:a,className:N("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t})));ae.displayName="TableHead";const re=e.forwardRef((({className:e,...t},a)=>s.jsx("td",{ref:a,className:N("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t})));re.displayName="TableCell",e.forwardRef((({className:e,...t},a)=>s.jsx("caption",{ref:a,className:N("mt-4 text-sm text-muted-foreground",e),...t}))).displayName="TableCaption";const ie=({shipments:r,isLoading:i,onStatusChange:n,getStatusBadgeColor:d,formatDate:l})=>{var c;const[o,m]=e.useState(null),[u,h]=e.useState(!1);return i?s.jsx("div",{className:"text-center py-8",children:"Loading shipments..."}):0===r.length?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No shipments found"}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(Z,{children:[s.jsx(ee,{children:s.jsxs(te,{children:[s.jsx(ae,{children:"Tracking Code"}),s.jsx(ae,{children:"User ID"}),s.jsx(ae,{children:"Origin"}),s.jsx(ae,{children:"Destination"}),s.jsx(ae,{children:"Created"}),s.jsx(ae,{children:"Status"}),s.jsx(ae,{children:"Actions"})]})}),s.jsx(se,{children:r.map((e=>{var a;return s.jsxs(te,{children:[s.jsx(re,{className:"font-medium",children:e.tracking_code||"N/A"}),s.jsx(re,{children:e.user_id?e.user_id.substring(0,8)+"...":"N/A"}),s.jsx(re,{children:e.pickup_address||"N/A"}),s.jsx(re,{children:e.delivery_address||"N/A"}),s.jsx(re,{children:l(e.created_at)}),s.jsx(re,{children:s.jsx(I,{className:d(e.status),children:(null==(a=e.status)?void 0:a.replace(/_/g," "))||"Unknown"})}),s.jsx(re,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(y,{size:"sm",variant:"outline",onClick:()=>(e=>{m(e),h(!0)})(e),children:[s.jsx(t,{className:"h-4 w-4 mr-1"}),"Details"]}),s.jsxs(S,{children:[s.jsx(w,{asChild:!0,children:s.jsx(y,{variant:"outline",size:"sm",children:"Update Status"})}),s.jsxs(b,{align:"end",children:[s.jsx(C,{onClick:()=>n(e.id,e.user_id,"pending"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Pending"}),s.jsx(C,{onClick:()=>n(e.id,e.user_id,"picked_up"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Picked Up"}),s.jsx(C,{onClick:()=>n(e.id,e.user_id,"in_transit"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as In Transit"}),s.jsx(C,{onClick:()=>n(e.id,e.user_id,"delivered"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Delivered"}),s.jsx(C,{onClick:()=>n(e.id,e.user_id,"exception"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Exception"}),s.jsx(C,{onClick:()=>n(e.id,e.user_id,"cancelled"),className:"hover:bg-gray-100/40 hover:text-red-500 cursor-pointer",children:"Set as Cancelled"})]})]})]})})]},e.id)}))})]})}),s.jsx(F,{open:u,onOpenChange:h,children:s.jsxs($,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[s.jsxs(z,{children:[s.jsxs(V,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Shipment Details"}),s.jsx(y,{variant:"ghost",size:"sm",onClick:()=>h(!1),className:"h-8 w-8 p-0",children:s.jsx(a,{className:"h-4 w-4"})})]}),s.jsx(H,{children:"Complete information for this shipment"})]}),o&&s.jsxs("div",{className:"space-y-4 mt-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h3",{className:"text-lg font-semibold",children:["Tracking Code: ",o.tracking_code||"N/A"]}),s.jsx(I,{className:d(o.status),children:(null==(c=o.status)?void 0:c.replace(/_/g," "))||"Unknown"})]}),s.jsx(Y,{}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-muted-foreground",children:"Shipment Information"}),s.jsxs("div",{className:"space-y-2 mt-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"User ID"}),s.jsx("p",{children:o.user_id||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Created At"}),s.jsx("p",{children:l(o.created_at)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Customer Type"}),s.jsx("p",{className:"capitalize",children:o.customer_type||"Private"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-muted-foreground",children:"Schedule"}),s.jsxs("div",{className:"space-y-2 mt-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Pickup Time"}),s.jsx("p",{children:o.pickup_time||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Cancellation Deadline"}),s.jsx("p",{children:o.cancellation_deadline?l(o.cancellation_deadline):"N/A"})]})]})]})]}),s.jsx(Y,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-muted-foreground",children:"Addresses"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Pickup Address"}),s.jsx("p",{children:o.pickup_address||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Delivery Address"}),s.jsx("p",{children:o.delivery_address||"N/A"})]})]})]}),s.jsx(Y,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-muted-foreground",children:"Package Details"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Weight"}),s.jsx("p",{children:o.weight||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Dimensions (L×W×H)"}),s.jsxs("p",{children:[o.dimension_length||"N/A"," × ",o.dimension_width||"N/A"," × ",o.dimension_height||"N/A"]})]})]})]}),s.jsx(Y,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-muted-foreground",children:"Pricing"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Carrier Price"}),s.jsx("p",{children:o.carrier_price?`€${parseFloat(o.carrier_price).toFixed(2)}`:"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Price"}),s.jsx("p",{className:"font-semibold",children:o.total_price?`€${parseFloat(o.total_price).toFixed(2)}`:"N/A"})]})]})]}),s.jsx(Y,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-muted-foreground",children:"Additional Information"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Business Name"}),s.jsx("p",{children:o.business_name||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"VAT Number"}),s.jsx("p",{children:o.vat_number||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Compliance Service"}),s.jsx("p",{children:o.include_compliance?"Yes":"No"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Label"}),s.jsx("p",{children:o.label_url?"Available":"Not available"})]})]})]})]}),s.jsxs(W,{className:"mt-6",children:[(null==o?void 0:o.label_url)&&s.jsx(y,{asChild:!0,variant:"outline",children:s.jsx("a",{href:o.label_url,target:"_blank",rel:"noopener noreferrer",children:"Open Shipping Label"})}),s.jsx(y,{onClick:()=>h(!1),children:"Close"})]})]})})]})},ne=({demoRequests:e,isLoading:t,onStatusChange:a,getStatusBadgeColor:r,formatDate:i})=>t?s.jsx("div",{className:"text-center py-8",children:"Loading demo requests..."}):0===e.length?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No demo requests found"}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(Z,{children:[s.jsx(ee,{children:s.jsxs(te,{children:[s.jsx(ae,{children:"Name"}),s.jsx(ae,{children:"Email"}),s.jsx(ae,{children:"Company"}),s.jsx(ae,{children:"Demo Type"}),s.jsx(ae,{children:"Preferred Date"}),s.jsx(ae,{children:"Created"}),s.jsx(ae,{children:"Status"}),s.jsx(ae,{children:"Actions"})]})}),s.jsx(se,{children:e.map((e=>s.jsxs(te,{children:[s.jsx(re,{className:"font-medium",children:e.name||"N/A"}),s.jsx(re,{children:e.email||"N/A"}),s.jsx(re,{children:e.company||"N/A"}),s.jsx(re,{children:e.demo_type||"N/A"}),s.jsx(re,{children:e.preferred_date||"N/A"}),s.jsx(re,{children:i(e.created_at)}),s.jsx(re,{children:s.jsx(I,{className:r(e.status),children:e.status||"Unknown"})}),s.jsx(re,{children:s.jsxs(S,{children:[s.jsx(w,{asChild:!0,children:s.jsx(y,{variant:"outline",size:"sm",children:"Update Status"})}),s.jsxs(b,{align:"end",children:[s.jsx(C,{onClick:()=>a(e.id,"pending"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Pending"}),s.jsx(C,{onClick:()=>a(e.id,"scheduled"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Scheduled"}),s.jsx(C,{onClick:()=>a(e.id,"completed"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Completed"}),s.jsx(C,{onClick:()=>a(e.id,"cancelled"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Cancelled"})]})]})})]},e.id)))})]})}),de=({supportTickets:e,isLoading:t,onStatusChange:a,getStatusBadgeColor:c,formatDate:o,onOpenTicket:m})=>t?s.jsx("div",{className:"text-center py-8",children:"Loading support tickets..."}):0===e.length?s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No support tickets found"}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(Z,{children:[s.jsx(ee,{children:s.jsxs(te,{children:[s.jsx(ae,{children:"Subject"}),s.jsx(ae,{children:"User ID"}),s.jsx(ae,{children:"Category"}),s.jsx(ae,{children:"Priority"}),s.jsx(ae,{children:"Created"}),s.jsx(ae,{children:"Status"}),s.jsx(ae,{children:"Actions"})]})}),s.jsx(se,{children:e.map((e=>s.jsxs(te,{children:[s.jsx(re,{className:"font-medium max-w-xs truncate",title:e.subject,children:e.subject}),s.jsx(re,{children:e.user_id?e.user_id.substring(0,8)+"...":"N/A"}),s.jsxs(re,{children:["billing"===e.category&&s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(r,{className:"h-4 w-4"})," Billing"]}),"shipping"===e.category&&s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(i,{className:"h-4 w-4"})," Shipping"]}),"technical"===e.category&&s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(n,{className:"h-4 w-4"})," Technical"]}),"general"===e.category&&s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(d,{className:"h-4 w-4"})," General"]}),!["billing","shipping","technical","general"].includes(e.category)&&e.category]}),s.jsx(re,{children:s.jsx(I,{className:"urgent"===e.priority?"bg-red-100 text-red-800":"high"===e.priority?"bg-orange-100 text-orange-800":"medium"===e.priority?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800",children:e.priority.charAt(0).toUpperCase()+e.priority.slice(1)})}),s.jsx(re,{children:o(e.created_at)}),s.jsx(re,{children:s.jsx(I,{className:c(e.status),children:"in_progress"===e.status?"In Progress":e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),s.jsx(re,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(y,{variant:"outline",size:"sm",onClick:()=>m(e),children:[s.jsx(l,{className:"h-4 w-4 mr-1"})," View"]}),s.jsxs(S,{children:[s.jsx(w,{asChild:!0,children:s.jsx(y,{variant:"outline",size:"sm",children:"Status"})}),s.jsxs(b,{align:"end",children:[s.jsx(C,{onClick:()=>a(e.id,"open"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Open"}),s.jsx(C,{onClick:()=>a(e.id,"in_progress"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as In Progress"}),s.jsx(C,{onClick:()=>a(e.id,"resolved"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Resolved"}),s.jsx(C,{onClick:()=>a(e.id,"closed"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Closed"})]})]})]})})]},e.id)))})]})}),le=({open:e,onOpenChange:t,selectedTicket:a,ticketMessages:l,newMessage:o,setNewMessage:m,sendingMessage:u,handleSendMessage:h,handleSupportTicketStatusChange:x,getStatusBadgeColor:p,formatDate:g})=>a?s.jsx(F,{open:e,onOpenChange:t,children:s.jsxs($,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[s.jsxs(z,{children:[s.jsx(V,{children:a.subject}),s.jsxs(H,{className:"flex items-center justify-between pt-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(I,{className:p(a.status),children:"in_progress"===a.status?"In Progress":a.status.charAt(0).toUpperCase()+a.status.slice(1)}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Priority:"," ",a.priority.charAt(0).toUpperCase()+a.priority.slice(1)]})]}),s.jsx("span",{className:"text-sm text-muted-foreground",children:g(a.created_at)})]})]}),s.jsxs("div",{className:"mt-4 space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"Category"}),s.jsxs("p",{className:"flex items-center gap-1.5 text-sm mt-1",children:["billing"===a.category&&s.jsx(r,{className:"h-4 w-4"}),"shipping"===a.category&&s.jsx(i,{className:"h-4 w-4"}),"technical"===a.category&&s.jsx(n,{className:"h-4 w-4"}),"general"===a.category&&s.jsx(d,{className:"h-4 w-4"}),a.category.charAt(0).toUpperCase()+a.category.slice(1)]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"User ID"}),s.jsx("p",{className:"text-sm mt-1",children:a.user_id})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"Original Message"}),s.jsx("div",{className:"mt-1 p-3 bg-muted rounded-md text-sm",children:s.jsx("p",{className:"whitespace-pre-wrap",children:a.message})})]}),l.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"Message History"}),s.jsx("div",{className:"space-y-3 mt-2 max-h-[200px] overflow-y-auto",children:l.map((e=>s.jsxs("div",{className:"p-3 rounded-md text-sm "+(e.is_admin?"bg-primary/10 ml-8":"bg-muted mr-8"),children:[s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"font-semibold",children:e.is_admin?"Support Agent":"Customer"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:g(e.created_at)})]}),s.jsx("p",{className:"whitespace-pre-wrap",children:e.message})]},e.id)))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"Reply"}),s.jsx("div",{className:"mt-1",children:s.jsx(G,{value:o,onChange:e=>m(e.target.value),placeholder:"Type your response here...",rows:3})})]}),s.jsxs("div",{className:"flex justify-between pt-4",children:[s.jsxs(S,{children:[s.jsx(w,{asChild:!0,children:s.jsx(y,{variant:"outline",children:"Update Status"})}),s.jsxs(b,{align:"start",children:[s.jsx(C,{onClick:()=>x(a.id,"open"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Open"}),s.jsx(C,{onClick:()=>x(a.id,"in_progress"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as In Progress"}),s.jsx(C,{onClick:()=>x(a.id,"resolved"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Resolved"}),s.jsx(C,{onClick:()=>x(a.id,"closed"),className:"hover:bg-gray-100/40 hover:text-primary/90 cursor-pointer",children:"Set as Closed"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(y,{variant:"default",onClick:h,disabled:!o.trim()||u,children:[u?"Sending...":"Send Reply",s.jsx(c,{className:"h-4 w-4 ml-1"})]}),s.jsx(y,{variant:"outline",onClick:()=>t(!1),children:"Close"})]})]})]})]})}):null,ce=({stats:e})=>s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:[s.jsxs(_,{className:"md:col-span-1",children:[s.jsx(k,{className:"pb-2",children:s.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Total Shipments"})}),s.jsx(T,{children:s.jsx("div",{className:"text-2xl font-bold",children:e.totalShipments})})]}),s.jsxs(_,{className:"md:col-span-1",children:[s.jsx(k,{className:"pb-2",children:s.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Pending Shipments"})}),s.jsx(T,{children:s.jsx("div",{className:"text-2xl font-bold",children:e.pendingShipments})})]}),s.jsxs(_,{className:"md:col-span-1",children:[s.jsx(k,{className:"pb-2",children:s.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Completed Shipments"})}),s.jsxs(T,{children:[s.jsx("div",{className:"text-2xl font-bold",children:e.completedShipments}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.totalShipments>0?`${Math.round(e.completedShipments/e.totalShipments*100)}% completion rate`:"No shipments recorded"})]})]}),s.jsxs(_,{className:"md:col-span-1",children:[s.jsx(k,{className:"pb-2",children:s.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Demo Requests"})}),s.jsx(T,{children:s.jsx("div",{className:"text-2xl font-bold",children:e.totalDemoRequests})})]}),s.jsxs(_,{className:"md:col-span-1",children:[s.jsx(k,{className:"pb-2",children:s.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Support Tickets"})}),s.jsx(T,{children:s.jsx("div",{className:"text-2xl font-bold",children:e.totalSupportTickets})})]}),s.jsxs(_,{className:"md:col-span-1",children:[s.jsx(k,{className:"pb-2",children:s.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Open Tickets"})}),s.jsxs(T,{children:[s.jsx("div",{className:"text-2xl font-bold",children:e.openSupportTickets}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.totalSupportTickets>0?`${Math.round(e.openSupportTickets/e.totalSupportTickets*100)}% open rate`:"No support tickets"})]})]})]});function oe({className:e,classNames:t,showOutsideDays:a=!0,...r}){return s.jsx(o,{showOutsideDays:a,classNames:{months:"flex flex-col sm:flex-row gap-4",month:"space-y-4",caption:"flex justify-between items-center py-2 px-4 bg-gray-100 rounded-md",caption_label:"text-sm font-semibold",nav:"flex items-center space-x-2",nav_button:N(A({variant:"outline"}),"h-8 w-8 bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 transition-all"),nav_button_previous:"",nav_button_next:"",table:"w-full border-collapse",head_row:"flex",head_cell:"text-gray-600 font-medium w-9 text-xs uppercase",row:"flex w-full",cell:"h-10 w-10 text-center text-sm relative",day:N(A({variant:"ghost"}),"h-10 w-10 p-0 font-medium rounded-md transition-all hover:bg-gray-200"),day_range_end:"rounded-r-md",day_selected:"bg-primary text-white font-bold hover:bg-primary-dark",day_today:"border border-primary text-primary font-bold",day_outside:"text-gray-400 opacity-50",day_disabled:"text-gray-300 opacity-50 cursor-not-allowed",day_range_middle:"bg-gray-100 text-gray-700",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>s.jsx(m,{className:"h-5 w-5 text-gray-600"}),IconRight:({...e})=>s.jsx(u,{className:"h-5 w-5 text-gray-600"})},...r})}oe.displayName="Calendar";const me=p,ue=g,he=e.forwardRef((({className:e,align:t="center",sideOffset:a=4,...r},i)=>s.jsx(h,{children:s.jsx(x,{ref:i,align:t,sideOffset:a,className:N("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})})));he.displayName=x.displayName;const xe=({onExport:t,isLoading:a})=>{const[r,i]=e.useState(new Date((new Date).setDate((new Date).getDate()-30))),[n,d]=e.useState(new Date),[l,c]=e.useState(!1),[o,m]=e.useState(!1);return s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-center",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"From:"}),s.jsxs(me,{open:l,onOpenChange:c,children:[s.jsx(ue,{asChild:!0,children:s.jsxs(y,{variant:"outline",className:"w-[140px] justify-start text-left font-normal",children:[s.jsx(j,{className:"mr-2 h-4 w-4"}),r?J(r,"MMM dd, yyyy"):"Select date"]})}),s.jsx(he,{className:"w-auto p-0",align:"start",children:s.jsx(oe,{mode:"single",selected:r,onSelect:e=>{i(e),c(!1),n&&e&&e>n&&d(e)},initialFocus:!0})})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"To:"}),s.jsxs(me,{open:o,onOpenChange:m,children:[s.jsx(ue,{asChild:!0,children:s.jsxs(y,{variant:"outline",className:"w-[140px] justify-start text-left font-normal",children:[s.jsx(j,{className:"mr-2 h-4 w-4"}),n?J(n,"MMM dd, yyyy"):"Select date"]})}),s.jsx(he,{className:"w-auto p-0",align:"end",children:s.jsx(oe,{mode:"single",selected:n,onSelect:e=>{d(e),m(!1)},disabled:e=>!!r&&e<r||e>new Date,initialFocus:!0})})]})]}),s.jsx(y,{onClick:async()=>{if(!r||!n)return;const e=J(r,"yyyy-MM-dd"),s=J(n,"yyyy-MM-dd");await t(e,s)},disabled:!r||!n||a,className:"ml-0 sm:ml-2",children:a?"Exporting...":"Export to Excel"})]})};let pe=null,ge=0;const je=new Map,ve=18e4,fe=new Map,Ne=e=>{if(fe.has(e))return fe.get(e);let s;switch(e){case"delivered":case"completed":s="bg-green-100 text-green-800";break;case"in_transit":case"scheduled":s="bg-blue-100 text-blue-800";break;case"pending":s="bg-yellow-100 text-yellow-800";break;case"picked_up":s="bg-purple-100 text-purple-800";break;case"exception":case"cancelled":s="bg-red-100 text-red-800";break;default:s="bg-gray-100 text-gray-800"}return fe.set(e,s),s},ye=new Map,Se=e=>{if(!e)return"N/A";if(ye.has(e))return ye.get(e);const s=new Date(e).toLocaleString();return ye.set(e,s),s},we=()=>{const{user:t}=v(),[a,r]=e.useState("shipments"),[i,n]=e.useState("all"),[d,l]=e.useState("all"),[c,o]=e.useState("all"),[m,u]=e.useState(!0),[h,x]=e.useState(!1),[p,g]=e.useState({totalShipments:0,pendingShipments:0,completedShipments:0,totalDemoRequests:0,totalSupportTickets:0,openSupportTickets:0}),[j,N]=e.useState([]),[S,w]=e.useState([]),[b,C]=e.useState(""),[A,I]=e.useState([]),[F,$]=e.useState([]),[z,V]=e.useState(""),[H,W]=e.useState([]),[G,Y]=e.useState([]),[J,Z]=e.useState(""),[ee,se]=e.useState(null),[te,ae]=e.useState(!1),[re,oe]=e.useState([]),[me,ue]=e.useState(""),[he,fe]=e.useState(!1);e.useEffect((()=>{t&&ye()}),[t]),e.useEffect((()=>{j.length>0&&we()}),[b,j]),e.useEffect((()=>{A.length>0&&be()}),[z,A]),e.useEffect((()=>{H.length>0&&Ce()}),[J,H]);const ye=async()=>{u(!0);try{await Promise.all([Te(),Ae(),Le(),Re()])}catch(e){R({title:"Error Loading Data",description:"There was a problem retrieving data from the database.",variant:"destructive"})}finally{u(!1)}},we=()=>{if(!b.trim())return void w(j);const e=b.toLowerCase(),s=j.filter((s=>{var t,a,r,i,n;return(null==(t=s.tracking_code)?void 0:t.toLowerCase().includes(e))||(null==(a=s.user_id)?void 0:a.toLowerCase().includes(e))||(null==(r=s.pickup_address)?void 0:r.toLowerCase().includes(e))||(null==(i=s.delivery_address)?void 0:i.toLowerCase().includes(e))||(null==(n=s.status)?void 0:n.toLowerCase().includes(e))}));w(s)},be=()=>{if(!z.trim())return void $(A);const e=z.toLowerCase(),s=A.filter((s=>{var t,a,r,i,n;return(null==(t=s.name)?void 0:t.toLowerCase().includes(e))||(null==(a=s.email)?void 0:a.toLowerCase().includes(e))||(null==(r=s.company)?void 0:r.toLowerCase().includes(e))||(null==(i=s.status)?void 0:i.toLowerCase().includes(e))||(null==(n=s.demo_type)?void 0:n.toLowerCase().includes(e))}));$(s)},Ce=()=>{if(!J.trim())return void Y(H);const e=J.toLowerCase(),s=H.filter((s=>{var t,a,r,i,n,d;return(null==(t=s.subject)?void 0:t.toLowerCase().includes(e))||(null==(a=s.message)?void 0:a.toLowerCase().includes(e))||(null==(r=s.user_id)?void 0:r.toLowerCase().includes(e))||(null==(i=s.category)?void 0:i.toLowerCase().includes(e))||(null==(n=s.priority)?void 0:n.toLowerCase().includes(e))||(null==(d=s.status)?void 0:d.toLowerCase().includes(e))}));Y(s)},_e=async(e,s,t)=>{await(async(e,s,t)=>{try{const{error:a}=await L.from("booking").update({status:t}).eq("id",e);if(a)return R({title:"Status Update Failed",description:"Could not update the shipment status in the database.",variant:"destructive"}),!1;const r={date:(new Date).toISOString(),location:"Admin Dashboard",status:t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," "),description:"Status updated by admin"};return await X(e.toString(),s,t,r),pe=null,ge=0,je.clear(),R({title:"Status Updated",description:`Shipment status changed to ${t.replace(/_/g," ")}.`}),!0}catch(a){return R({title:"Update Failed",description:"An unexpected error occurred while updating the status.",variant:"destructive"}),!1}})(e,s,t)&&(N(j.map((s=>s.id===e?{...s,status:t}:s))),Te(),Re())},ke=async(e,s)=>{const t=await(async(e,s)=>{try{const{error:t}=await L.from("demo_requests").update({status:s}).eq("id",e);return t?(R({title:"Status Update Failed",description:"Could not update the demo request status.",variant:"destructive"}),!1):(R({title:"Status Updated",description:`Demo request status changed to ${s}.`}),!0)}catch(t){return R({title:"Update Failed",description:"An unexpected error occurred while updating the status.",variant:"destructive"}),!1}})(e,s);t&&Ae()},De=async(e,s)=>{const t=await(async(e,s)=>{try{const{error:t}=await L.from("support_tickets").update({status:s}).eq("id",e);return t?(R({title:"Status Update Failed",description:"Could not update the support ticket status.",variant:"destructive"}),!1):(R({title:"Status Updated",description:`Support ticket status changed to ${s}.`}),!0)}catch(t){return R({title:"Update Failed",description:"An unexpected error occurred while updating the status.",variant:"destructive"}),!1}})(e,s);t&&(ee&&ee.id===e&&se({...ee,status:s}),Le(),Re())},Te=async()=>{const e=await(async()=>{try{const e="admin-shipments",s=je.get(e);if(s&&Date.now()-s.timestamp<ve)return s.data;const{data:t,error:a}=await L.from("booking").select("*").order("created_at",{ascending:!1});return a?(R({title:"Error Loading Shipments",description:a.message,variant:"destructive"}),[]):(je.set(e,{data:t||[],timestamp:Date.now()}),t||[])}catch(e){return[]}})();N(e),w(e)},Ae=async()=>{const e=await(async()=>{try{const e="admin-demos",s=je.get(e);if(s&&Date.now()-s.timestamp<ve)return s.data;const{data:t,error:a}=await L.from("demo_requests").select("*").order("created_at",{ascending:!1});return a?[]:(je.set(e,{data:t||[],timestamp:Date.now()}),t||[])}catch(e){return[]}})();I(e),$(e)},Le=async()=>{const e=await(async()=>{try{const e="admin-support-tickets",s=je.get(e);if(s&&Date.now()-s.timestamp<ve)return s.data;const{data:t,error:a}=await L.from("support_tickets").select("*").order("created_at",{ascending:!1});return a?(R({title:"Error Loading Support Tickets",description:a.message,variant:"destructive"}),[]):(je.set(e,{data:t||[],timestamp:Date.now()}),t||[])}catch(e){return[]}})();W(e),Y(e)},Re=async()=>{const e=await(async()=>{try{if(pe&&Date.now()-ge<3e5)return pe;const{count:e,error:s}=await L.from("booking").select("*",{count:"exact",head:!0}),{count:t,error:a}=await L.from("booking").select("*",{count:"exact",head:!0}).in("status",["pending","picked_up","in_transit"]),{count:r,error:i}=await L.from("booking").select("*",{count:"exact",head:!0}).eq("status","delivered"),{count:n,error:d}=await L.from("demo_requests").select("*",{count:"exact",head:!0}),{count:l,error:c}=await L.from("support_tickets").select("*",{count:"exact",head:!0}),{count:o,error:m}=await L.from("support_tickets").select("*",{count:"exact",head:!0}).eq("status","open");if(s||a||i||d||c||m)return{totalShipments:0,pendingShipments:0,completedShipments:0,totalDemoRequests:0,totalSupportTickets:0,openSupportTickets:0};{const s={totalShipments:e||0,pendingShipments:t||0,completedShipments:r||0,totalDemoRequests:n||0,totalSupportTickets:l||0,openSupportTickets:o||0};return pe=s,ge=Date.now(),s}}catch(e){return{totalShipments:0,pendingShipments:0,completedShipments:0,totalDemoRequests:0,totalSupportTickets:0,openSupportTickets:0}}})();g(e)},Me=async e=>{const s=await(async e=>{try{const s=`ticket-messages-${e}`,t=je.get(s);if(t&&Date.now()-t.timestamp<ve)return t.data;const{data:a,error:r}=await L.from("support_messages").select("*").eq("ticket_id",e).order("created_at",{ascending:!0});if(r)throw r;return je.set(s,{data:a||[],timestamp:Date.now()}),a||[]}catch(s){return R({title:"Error",description:"Failed to load message history",variant:"destructive"}),[]}})(e);oe(s)},qe=async e=>{se(e),ae(!0),await Me(e.id)};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(M,{}),s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Dashboard"}),s.jsx("p",{className:"text-muted-foreground",children:"Manage shipments, demo requests and support tickets"})]}),s.jsx(y,{onClick:()=>{ye(),R({title:"Data Refreshed",description:"The dashboard data has been updated."})},children:"Refresh Data"})]}),s.jsx(ce,{stats:p}),s.jsxs(_,{children:[s.jsx(k,{children:s.jsxs(O,{value:a,onValueChange:r,children:[s.jsxs(P,{className:"mb-4",children:[s.jsx(U,{value:"shipments",children:"Shipments"}),s.jsx(U,{value:"demos",children:"Demo Requests"}),s.jsx(U,{value:"support",children:"Support Tickets"})]}),s.jsxs(D,{children:["shipments"===a&&"Shipment Management","demos"===a&&"Demo Requests Management","support"===a&&"Support Tickets Management"]}),s.jsxs(q,{children:["shipments"===a&&"View and manage all shipments across the platform","demos"===a&&"Review and respond to demo requests from potential customers","support"===a&&"Respond to customer support inquiries and issues"]})]})}),s.jsx(T,{children:s.jsxs(O,{value:a,children:[s.jsxs(E,{value:"shipments",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"text-muted-foreground h-5 w-5"}),s.jsx(B,{placeholder:"Search by tracking code, user, address...",value:b,onChange:e=>C(e.target.value),className:"max-w-sm"})]}),s.jsx(xe,{onExport:async(e,s)=>{try{x(!0),await(async(e,s)=>{try{const t=await(async(e,s)=>{try{const t=new Date(e),a=new Date(s);a.setDate(a.getDate()+1);const{data:r,error:i}=await L.from("booking").select("*").gte("created_at",t.toISOString()).lt("created_at",a.toISOString()).order("created_at",{ascending:!1});return i?(R({title:"Error Loading Shipments",description:i.message,variant:"destructive"}),[]):r||[]}catch(t){return[]}})(e,s);if(0===t.length)return R({title:"No Data to Export",description:"There are no shipments in the selected date range.",variant:"destructive"}),!1;const a=t.map((e=>({"Tracking Code":e.tracking_code,"User ID":e.user_id,"Customer Type":e.customer_type,"Business Name":e.business_name||"N/A","VAT Number":e.vat_number||"N/A","Weight (kg)":e.weight,"Dimensions (cm)":`${e.dimension_length}x${e.dimension_width}x${e.dimension_height}`,"Pickup Address":e.pickup_address,"Delivery Address":e.delivery_address,Carrier:e.carrier_name,"Carrier Price":e.carrier_price,"Total Price":e.total_price,"Pickup Time":e.pickup_time,Status:e.status,"Created At":Se(e.created_at),"Estimated Delivery":e.estimated_delivery,"Delivery Speed":e.delivery_speed}))),r=K.json_to_sheet(a),i=K.book_new();K.book_append_sheet(i,r,"Shipments");const n=`shipments_${e.replace(/-/g,"")}_to_${s.replace(/-/g,"")}.xlsx`;return Q(i,n),R({title:"Export Successful",description:`Shipments exported to ${n}`}),!0}catch(t){return R({title:"Export Failed",description:"Failed to export shipments. Please try again.",variant:"destructive"}),!1}})(e,s)}catch(t){R({title:"Export Failed",description:"An unexpected error occurred during export.",variant:"destructive"})}finally{x(!1)}},isLoading:h})]}),s.jsxs(O,{value:i,onValueChange:n,children:[s.jsxs(P,{className:"mb-4",children:[s.jsx(U,{value:"all",children:"All Shipments"}),s.jsx(U,{value:"pending",children:"Pending"}),s.jsx(U,{value:"in_transit",children:"In Transit"}),s.jsx(U,{value:"delivered",children:"Delivered"}),s.jsx(U,{value:"exception",children:"Exceptions"}),s.jsx(U,{value:"cancelled",children:"Cancelled"})]}),s.jsx(E,{value:"all",children:s.jsx(ie,{shipments:S,isLoading:m,onStatusChange:_e,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"pending",children:s.jsx(ie,{shipments:S.filter((e=>"pending"===e.status)),isLoading:m,onStatusChange:_e,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"in_transit",children:s.jsx(ie,{shipments:S.filter((e=>"in_transit"===e.status)),isLoading:m,onStatusChange:_e,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"delivered",children:s.jsx(ie,{shipments:S.filter((e=>"delivered"===e.status)),isLoading:m,onStatusChange:_e,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"exception",children:s.jsx(ie,{shipments:S.filter((e=>"exception"===e.status)),isLoading:m,onStatusChange:_e,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"cancelled",children:s.jsx(ie,{shipments:S.filter((e=>"cancelled"===e.status)),isLoading:m,onStatusChange:_e,getStatusBadgeColor:Ne,formatDate:Se})})]})]}),s.jsxs(E,{value:"demos",children:[s.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[s.jsx(f,{className:"text-muted-foreground h-5 w-5"}),s.jsx(B,{placeholder:"Search by name, email, company...",value:z,onChange:e=>V(e.target.value),className:"max-w-sm"})]}),s.jsxs(O,{value:d,onValueChange:l,children:[s.jsxs(P,{className:"mb-4",children:[s.jsx(U,{value:"all",children:"All Requests"}),s.jsx(U,{value:"pending",children:"Pending"}),s.jsx(U,{value:"scheduled",children:"Scheduled"}),s.jsx(U,{value:"completed",children:"Completed"})]}),s.jsx(E,{value:"all",children:s.jsx(ne,{demoRequests:F,isLoading:m,onStatusChange:ke,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"pending",children:s.jsx(ne,{demoRequests:F.filter((e=>"pending"===e.status)),isLoading:m,onStatusChange:ke,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"scheduled",children:s.jsx(ne,{demoRequests:F.filter((e=>"scheduled"===e.status)),isLoading:m,onStatusChange:ke,getStatusBadgeColor:Ne,formatDate:Se})}),s.jsx(E,{value:"completed",children:s.jsx(ne,{demoRequests:F.filter((e=>"completed"===e.status)),isLoading:m,onStatusChange:ke,getStatusBadgeColor:Ne,formatDate:Se})})]})]}),s.jsxs(E,{value:"support",children:[s.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[s.jsx(f,{className:"text-muted-foreground h-5 w-5"}),s.jsx(B,{placeholder:"Search by subject, message, user ID, category...",value:J,onChange:e=>Z(e.target.value),className:"max-w-sm"})]}),s.jsxs(O,{value:c,onValueChange:o,children:[s.jsxs(P,{className:"mb-4",children:[s.jsx(U,{value:"all",children:"All Tickets"}),s.jsx(U,{value:"open",children:"Open"}),s.jsx(U,{value:"in_progress",children:"In Progress"}),s.jsx(U,{value:"resolved",children:"Resolved"}),s.jsx(U,{value:"closed",children:"Closed"})]}),s.jsx(E,{value:"all",children:s.jsx(de,{supportTickets:G,isLoading:m,onStatusChange:De,getStatusBadgeColor:Ne,formatDate:Se,onOpenTicket:qe})}),s.jsx(E,{value:"open",children:s.jsx(de,{supportTickets:G.filter((e=>"open"===e.status)),isLoading:m,onStatusChange:De,getStatusBadgeColor:Ne,formatDate:Se,onOpenTicket:qe})}),s.jsx(E,{value:"in_progress",children:s.jsx(de,{supportTickets:G.filter((e=>"in_progress"===e.status)),isLoading:m,onStatusChange:De,getStatusBadgeColor:Ne,formatDate:Se,onOpenTicket:qe})}),s.jsx(E,{value:"resolved",children:s.jsx(de,{supportTickets:G.filter((e=>"resolved"===e.status)),isLoading:m,onStatusChange:De,getStatusBadgeColor:Ne,formatDate:Se,onOpenTicket:qe})}),s.jsx(E,{value:"closed",children:s.jsx(de,{supportTickets:G.filter((e=>"closed"===e.status)),isLoading:m,onStatusChange:De,getStatusBadgeColor:Ne,formatDate:Se,onOpenTicket:qe})})]})]})]})})]})]})}),s.jsx(le,{open:te,onOpenChange:ae,selectedTicket:ee,ticketMessages:re,newMessage:me,setNewMessage:ue,sendingMessage:he,handleSendMessage:async()=>{if(me.trim()&&ee&&t){fe(!0);try{await(async(e,s,t,a=!0)=>{try{const r={ticket_id:e,user_id:s,message:t.trim(),is_admin:a},{error:i}=await L.from("support_messages").insert(r);if(i)throw i;return R({title:"Message Sent",description:"Your response has been sent to the user."}),!0}catch(r){return R({title:"Error",description:"Failed to send your response",variant:"destructive"}),!1}})(ee.id,t.id,me)&&("open"===ee.status&&await De(ee.id,"in_progress"),await Me(ee.id),ue(""))}finally{fe(!1)}}},handleSupportTicketStatusChange:De,getStatusBadgeColor:Ne,formatDate:Se})]})};export{we as default};
