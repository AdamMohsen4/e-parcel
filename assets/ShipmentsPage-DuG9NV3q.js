const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shipmentService-5eWvZyUL.js","assets/index-CHSTzK31.js","assets/vendor-react-c2Vhr46D.js","assets/vendor-Do_qGNvM.js","assets/vendor-ui-CttiZxwU.js","assets/index-CgNEjc2t.css"])))=>i.map(i=>d[i]);
import{ax as e}from"./vendor-Do_qGNvM.js";import{u as s,r as t,j as a,Y as i,bh as l,ay as n,az as r,K as d,ae as c}from"./vendor-react-c2Vhr46D.js";import{t as m,N as x,B as o,C as h,e as p,j as u,a as g}from"./index-CHSTzK31.js";import{f as j,a as f}from"./bookingDb-DitELtZx.js";import{T as v,a as N,b,c as y}from"./tabs-SeVHyK0Y.js";import"./vendor-ui-CttiZxwU.js";const w=()=>{const{user:w,isSignedIn:k}=s(),[_,S]=t.useState([]),[C,D]=t.useState(!0),[P,A]=t.useState("all"),[T,E]=t.useState(null);t.useEffect((()=>{k&&w&&L()}),[k,w]);const L=async()=>{if(w){D(!0);try{const e=await j(w.id);if(e&&e.length>0){const s=e.map((e=>({id:e.id.toString(),userId:e.user_id,trackingCode:e.tracking_code||"",carrier:{name:e.carrier_name||"E-Parcel Nordic",price:Number(e.carrier_price)||10},weight:e.weight||"",dimensions:{length:e.dimension_length||"",width:e.dimension_width||"",height:e.dimension_height||""},pickup:e.pickup_address||"",delivery:e.delivery_address||"",deliverySpeed:e.delivery_speed||"standard",includeCompliance:e.include_compliance||!1,status:e.status||"pending",createdAt:e.created_at,labelUrl:e.label_url,pickupTime:e.pickup_time,totalPrice:Number(e.total_price)||10,estimatedDelivery:e.estimated_delivery?new Date(e.estimated_delivery).toISOString().split("T")[0]:void 0,events:[]})));S(s)}else{const e=await I(w.id);S(e)}}catch(e){m({title:"Loading Error",description:"Could not load your shipments. Please try again.",variant:"destructive"})}finally{D(!1)}}},I=async s=>{try{return await e((()=>import("./shipmentService-5eWvZyUL.js")),__vite__mapDeps([0,1,2,3,4,5])).then((e=>e.getShipments(s)))}catch(t){return[]}},U=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-blue-100 text-blue-800";case"in_transit":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"exception":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},$="all"===P?_:_.filter((e=>{switch(P){case"active":return["pending","picked_up","in_transit"].includes(e.status);case"delivered":return"delivered"===e.status;case"exception":return"exception"===e.status;case"cancelled":return"cancelled"===e.status;default:return!0}}));return a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(x,{}),a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-2",children:a.jsx(o,{variant:"ghost",size:"sm",asChild:!0,className:"flex items-center gap-1 -ml-2",children:a.jsxs(i,{to:"/dashboard",children:[a.jsx(l,{className:"h-4 w-4"})," Back to Dashboard"]})})}),a.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Shipments"}),a.jsx("p",{className:"text-muted-foreground",children:"Track and manage all your shipments"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(o,{variant:"outline",onClick:()=>{L()},disabled:C,children:[C?a.jsx(n,{className:"h-4 w-4 animate-spin"}):a.jsx(r,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-2",children:"Refresh"})]}),a.jsx(o,{asChild:!0,children:a.jsx(i,{to:"/shipment",children:"New Shipment"})})]})]}),a.jsxs(h,{children:[a.jsx(p,{className:"pb-2",children:a.jsx(u,{children:"Shipment List"})}),a.jsx(g,{children:a.jsxs(v,{defaultValue:"all",value:P,onValueChange:A,className:"w-full",children:[a.jsxs(N,{className:"mb-4",children:[a.jsx(b,{value:"all",children:"All Shipments"}),a.jsx(b,{value:"active",children:"Active"}),a.jsx(b,{value:"delivered",children:"Delivered"}),a.jsx(b,{value:"exception",children:"Exceptions"}),a.jsx(b,{value:"cancelled",children:"Cancelled"})]}),a.jsx(y,{value:P,className:"mt-0",children:C?a.jsx("div",{className:"flex justify-center p-8",children:a.jsx(n,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===$.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(d,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),a.jsx("h3",{className:"font-medium text-lg mb-2",children:"all"===P?"No shipments found":`No ${P} shipments found`}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"all"===P?"Book your first shipment to get started":"Try selecting a different filter or book a new shipment"}),a.jsx(o,{asChild:!0,children:a.jsx(i,{to:"/shipment",children:"Book a Shipment"})})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full border-collapse",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-border",children:[a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Tracking"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Route"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Status"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Created"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Delivery"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Price"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-border",children:$.map((e=>a.jsxs("tr",{className:"hover:bg-muted/50",children:[a.jsxs("td",{className:"py-3 px-4",children:[a.jsx("div",{className:"font-medium",children:e.trackingCode}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.carrier.name})]}),a.jsx("td",{className:"py-3 px-4",children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"truncate max-w-[150px]",title:e.pickup,children:e.pickup}),a.jsx("span",{className:"text-xs",children:"↓"}),a.jsx("span",{className:"truncate max-w-[150px]",title:e.delivery,children:e.delivery})]})}),a.jsx("td",{className:"py-3 px-4",children:a.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${U(e.status)}`,children:["pending"===e.status&&"Pending","picked_up"===e.status&&"Picked Up","in_transit"===e.status&&"In Transit","delivered"===e.status&&"Delivered","exception"===e.status&&"Exception","cancelled"===e.status&&"Cancelled"]})}),a.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:new Date(e.createdAt).toLocaleDateString()}),a.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:e.estimatedDelivery?new Date(e.estimatedDelivery).toLocaleDateString():"N/A"}),a.jsxs("td",{className:"py-3 px-4 whitespace-nowrap",children:["€",e.totalPrice.toFixed(2)]}),a.jsx("td",{className:"py-3 px-4",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(o,{size:"sm",variant:"outline",asChild:!0,children:a.jsx(i,{to:`/tracking?code=${e.trackingCode}`,children:"Track"})}),a.jsxs(o,{size:"sm",variant:"outline",onClick:()=>(async e=>{const s=e.trackingCode,t="SHIP-"+Math.floor(1e6*Math.random());if(s){E(e.id);try{const a=`${e.dimensions.length}x${e.dimensions.width}x${e.dimensions.height} cm`,i=await f({shipmentId:t,carrierName:e.carrier.name,trackingCode:s,senderAddress:e.pickup,recipientAddress:e.delivery,packageDetails:{weight:e.weight,dimensions:a},language:"en"});i.success?(window.open(i.labelUrl,"_blank"),m({title:"Label Generated",description:"Your shipping label has been generated successfully"})):m({title:"Label Generation Failed",description:i.message||"Unable to generate shipping label",variant:"destructive"})}catch(a){m({title:"Label Generation Error",description:"An unexpected error occurred",variant:"destructive"})}finally{E(null)}}else m({title:"Error",description:"Unable to generate label: missing tracking code",variant:"destructive"})})(e),disabled:T===e.id,children:[T===e.id?a.jsx(n,{className:"h-3 w-3 animate-spin"}):a.jsx(c,{className:"h-3 w-3 mr-1"}),"Label"]})]})})]},e.id)))})]})})})]})})]}),a.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4",children:[a.jsx("h3",{className:"font-medium mb-2",children:"About Shipment Statuses"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full text-xs",children:"Pending"})}),a.jsx("p",{className:"text-muted-foreground",children:"Shipment has been booked but not yet picked up."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs",children:"Picked Up"})}),a.jsx("p",{className:"text-muted-foreground",children:"Carrier has collected the package."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full text-xs",children:"In Transit"})}),a.jsx("p",{className:"text-muted-foreground",children:"Package is on its way to the destination."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs",children:"Delivered"})}),a.jsx("p",{className:"text-muted-foreground",children:"Package has been delivered successfully."})]}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded-full text-xs",children:"Cancelled"})}),a.jsx("p",{className:"text-muted-foreground",children:"Shipment has been cancelled."})]})]})]})]})})]})};export{w as default};
